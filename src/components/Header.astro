<nav
  class="fixed top-0 w-full z-50 px-6 py-4"
  style="padding-top: max(1rem, env(safe-area-inset-top)); padding-left: max(1.5rem, env(safe-area-inset-left)); padding-right: max(1.5rem, env(safe-area-inset-right));"
>
  <div
    class="max-w-7xl mx-auto glass-panel rounded-full px-6 py-3 flex justify-between items-center"
  >
    <!-- Left: Logo -->
    <a
      href="/"
      class="text-xl md:text-xl font-display font-bold bg-clip-text text-transparent bg-gradient-to-r from-brand-accent to-brand-primary z-50 relative"
    >
      Gin's Blog
    </a>

    <!-- Center: Dynamic Dock (Navigation + Search) - Hidden on mobile -->
    <div
      class="hidden md:flex absolute left-1/2 -translate-x-1/2 items-center gap-1 p-1 bg-white/5 border border-white/10 rounded-full backdrop-blur-3xl shadow-lg hover:border-white/20 transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] group/dock"
    >
      <!-- Nav Links -->
      <nav
        class="flex items-center gap-1 px-2 transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] group-hover/search:opacity-50 group-hover/search:scale-95 group-hover/search:blur-[1px]"
      >
        <a
          href="/"
          class="px-4 py-2 text-sm font-medium text-gray-400 hover:text-white rounded-full transition-all"
          >Home</a
        >
        <a
          href="/blog"
          class="px-4 py-2 text-sm font-medium text-gray-400 hover:text-white rounded-full transition-all"
          >Blog</a
        >
        <a
          href="/about"
          class="px-4 py-2 text-sm font-medium text-gray-400 hover:text-white rounded-full transition-all"
          >About</a
        >
      </nav>

      <!-- Morphing Search Trigger -->
      <button
        id="search-trigger-btn"
        class="group/search relative flex items-center justify-center h-8 w-8 bg-white/10 hover:bg-brand-primary/20 hover:w-48 border border-white/5 hover:border-brand-primary/30 rounded-full transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] overflow-hidden cursor-text"
      >
        <!-- Custom SVG Search Icon -->
        <svg
          class="absolute left-2 w-4 h-4 z-10 transition-all duration-300 group-hover/search:scale-110"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <defs>
            <linearGradient
              id="searchGradient"
              x1="0%"
              y1="0%"
              x2="100%"
              y2="100%"
            >
              <stop offset="0%" style="stop-color:#a855f7;stop-opacity:1"
              ></stop>
              <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1"
              ></stop>
            </linearGradient>
          </defs>
          <!-- Search Circle -->
          <circle
            cx="10"
            cy="10"
            r="6"
            stroke="url(#searchGradient)"
            stroke-width="2"></circle>
          <!-- Inner Glow -->
          <circle
            cx="10"
            cy="10"
            r="3"
            fill="url(#searchGradient)"
            opacity="0.2"
            class="group-hover/search:opacity-30 transition-opacity"></circle>
          <!-- Handle -->
          <line
            x1="14.5"
            y1="14.5"
            x2="20"
            y2="20"
            stroke="url(#searchGradient)"
            stroke-width="2"
            stroke-linecap="round"></line>
        </svg>

        <!-- Text Label (Reveals on Hover) -->
        <div
          class="flex items-center gap-2 pl-8 opacity-0 group-hover/search:opacity-100 translate-x-4 group-hover/search:translate-x-0 transition-all duration-500 delay-75 whitespace-nowrap"
        >
          <span class="text-xs text-gray-200">Search...</span>
          <kbd
            class="px-1.5 py-0.5 text-[10px] text-brand-primary bg-brand-primary/10 border border-brand-primary/20 rounded font-mono"
            >âŒ˜K</kbd
          >
        </div>
      </button>
    </div>

    <!-- Right: Auth/Profile -->
    <div class="z-50 relative">
      {
        Astro.locals.user ? (
          <a
            href="/profile"
            class="flex items-center gap-3 hover:opacity-80 transition-opacity"
          >
            <span class="text-xs font-mono hidden md:block text-gray-300">
              {Astro.locals.user.username}
            </span>
            <img
              src={
                Astro.locals.user.avatar ||
                `https://ui-avatars.com/api/?name=${Astro.locals.user.username}`
              }
              class="w-8 h-8 rounded-full border border-white/10 shadow-sm"
              alt="Avatar"
            />
          </a>
        ) : (
          <a
            href="/login"
            class="px-4 md:px-5 py-2.5 md:py-2 rounded-full bg-white/5 hover:bg-white/10 text-xs md:text-xs font-bold tracking-wide transition-all border border-white/10 hover:border-white/20 hover:scale-105 active:scale-95"
          >
            LOGIN
          </a>
        )
      }
    </div>
  </div>

  <script>
    // Dispatch custom event or toggle state
    const btn = document.getElementById("search-trigger-btn");
    if (btn) {
      btn.addEventListener("click", () => {
        // Simulate Cmd+K or expose a global function
        window.dispatchEvent(
          new KeyboardEvent("keydown", { key: "k", metaKey: true }),
        );
      });
    }
  </script>
</nav>
